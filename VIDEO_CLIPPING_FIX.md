# è§†é¢‘è£å‰ªæ—¶é•¿ä¸ç²¾ç¡®é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ› é—®é¢˜æè¿°

### ç—‡çŠ¶
- **æœŸæœ›**: è£å‰ª 4.8 ç§’çš„è§†é¢‘ç‰‡æ®µï¼ˆ0s - 4.8sï¼‰
- **å®é™…**: åªæ‹¼æ¥äº†çº¦ 1 ç§’çš„å†…å®¹

### æ ¹æœ¬åŸå› 
**FFmpeg çš„ `-ss` å‚æ•°ä½ç½®å¯¼è‡´è£å‰ªä¸ç²¾ç¡®**

```javascript
// âŒ é”™è¯¯ï¼š-ss åœ¨ -i ä¹‹å‰ï¼ˆå¿«é€Ÿå®šä½æ¨¡å¼ï¼‰
"-ss", "0",
"-i", "input.mp4",
"-t", "4.8"
```

**é—®é¢˜**:
- `-ss` åœ¨ `-i` ä¹‹å‰æ—¶ï¼ŒFFmpeg ä½¿ç”¨**å…³é”®å¸§å®šä½**ï¼ˆkeyframe seekingï¼‰
- ä¼šå®šä½åˆ°**æœ€è¿‘çš„å…³é”®å¸§**ï¼ˆé€šå¸¸æ˜¯æ¯ 250 å¸§ä¸€ä¸ªï¼Œçº¦ 10 ç§’é—´éš”ï¼‰
- ä¾‹å¦‚ï¼š0s â†’ 3.9s çš„å…³é”®å¸§ï¼Œå¯¼è‡´åªè£å‰ªäº† 0.9 ç§’ï¼ˆ4.8 - 3.9 = 0.9ï¼‰

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒæ”¹è¿›ï¼šæ™ºèƒ½è£å‰ªæ¨¡å¼

```javascript
// å¯¹äºçŸ­è§†é¢‘ï¼ˆ<10ç§’ï¼‰ï¼Œä½¿ç”¨ç²¾ç¡®è£å‰ªæ¨¡å¼
const useAccurateMode = duration < 10;

const argsCopy = useAccurateMode ? [
  "-i", inputPath,
  "-ss", startTime.toString(),  // âœ… åœ¨ -i ä¹‹åï¼ˆå¸§çº§ç²¾ç¡®ï¼‰
  "-t", duration.toString(),
  "-c", "copy",
  "-avoid_negative_ts", "make_zero",
  "-y",
  outputPath
] : [
  "-ss", startTime.toString(),  // å¿«é€Ÿæ¨¡å¼ï¼ˆé•¿è§†é¢‘ï¼‰
  "-i", inputPath,
  "-t", duration.toString(),
  "-c", "copy",
  "-avoid_negative_ts", "1",
  "-y",
  outputPath
];
```

### ä¸¤ç§æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | -ss ä½ç½® | ç²¾åº¦ | é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| **ç²¾ç¡®æ¨¡å¼** | `-i` ä¹‹å | **å¸§çº§** | æ…¢ï¼ˆéœ€è§£ç ï¼‰ | çŸ­è§†é¢‘ < 10ç§’ |
| **å¿«é€Ÿæ¨¡å¼** | `-i` ä¹‹å‰ | å…³é”®å¸§çº§ï¼ˆ~10ç§’ï¼‰ | å¿«ï¼ˆæµå¤åˆ¶ï¼‰ | é•¿è§†é¢‘ â‰¥ 10ç§’ |

---

## ğŸ”§ è¯¦ç»†æ”¹è¿›

### 1. **æ·»åŠ è°ƒè¯•æ—¥å¿—**
```javascript
logFn(`è£å‰ªå‚æ•°: å¼€å§‹=${startTime.toFixed(2)}s, ç»“æŸ=${endTime.toFixed(2)}s, æ—¶é•¿=${duration.toFixed(2)}s`);
logFn(`ä½¿ç”¨${useAccurateMode ? 'ç²¾ç¡®' : 'å¿«é€Ÿ'}è£å‰ªæ¨¡å¼`);
```

**æ•ˆæœ**: å¯ä»¥æ¸…æ¥šçœ‹åˆ°ä½¿ç”¨çš„æ¨¡å¼å’Œå‚æ•°

---

### 2. **éªŒè¯è¾“å‡ºæ—¶é•¿**
```javascript
const durationCheck = execSync(
  `"${ffprobePath}" -v error -show_entries format=duration -of csv=p=0 "${outputPath}"`
);
const actualDuration = parseFloat(durationCheck.trim());
logFn(`è¾“å‡ºéªŒè¯: æœŸæœ› ${duration.toFixed(2)}s, å®é™… ${actualDuration.toFixed(2)}s`);

// å¦‚æœæ—¶é•¿å·®å¼‚è¶…è¿‡ 10%ï¼Œè‡ªåŠ¨é‡æ–°ç¼–ç 
if (Math.abs(actualDuration - duration) / duration > 0.1) {
  logFn('è­¦å‘Š: è£å‰ªæ—¶é•¿åå·®è¿‡å¤§ï¼Œé‡æ–°ç¼–ç ');
  fs.unlinkSync(outputPath);
  throw new Error('æ—¶é•¿ä¸ç²¾ç¡®');
}
```

**æ•ˆæœ**:
- å®æ—¶ç›‘æ§è£å‰ªç²¾åº¦
- è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤ä¸ç²¾ç¡®çš„è£å‰ª
- é¿å…ç”Ÿæˆé”™è¯¯çš„è§†é¢‘

---

### 3. **ä¼˜åŒ–é‡æ–°ç¼–ç å‚æ•°**
```javascript
const argsEncode = [
  "-i", inputPath,  // âœ… -i åœ¨ -ss ä¹‹å‰ï¼ˆé‡æ–°ç¼–ç æ—¶å¯ä»¥ç²¾ç¡®å®šä½ï¼‰
  "-ss", startTime.toString(),
  "-t", duration.toString(),
  "-c:v", "libx264",
  "-preset", "superfast",  // å¿«é€Ÿé¢„è®¾
  "-crf", "23",
  "-avoid_negative_ts", "make_zero",  // ä½¿ç”¨ make_zero è€Œä¸æ˜¯ 1
  "-y",
  outputPath
];
```

**å…³é”®ç‚¹**:
- é‡æ–°ç¼–ç æ—¶ï¼Œ`-i` åœ¨ `-ss` ä¹‹å‰ä¹Ÿèƒ½ç²¾ç¡®å®šä½
- `-avoid_negative_ts make_zero` ç¡®ä¿æ—¶é—´æˆ³ä» 0 å¼€å§‹
- ä½¿ç”¨ `superfast` é¢„è®¾å‡å°‘ç­‰å¾…æ—¶é—´

---

### 4. **æ— éŸ³é¢‘è§†é¢‘ä¹Ÿä½¿ç”¨ç²¾ç¡®å®šä½**
```javascript
const argsWithSilent = [
  "-i", inputPath,  // âœ… -i åœ¨ -ss ä¹‹å‰
  "-ss", startTime.toString(),
  "-t", duration.toString(),
  // ... å…¶ä»–å‚æ•°
];
```

**æ•ˆæœ**: æ— éŸ³é¢‘è§†é¢‘ä¹Ÿèƒ½ç²¾ç¡®è£å‰ª

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
```bash
# å‘½ä»¤ï¼ˆå¿«é€Ÿæ¨¡å¼ï¼‰
ffmpeg -ss 0 -i input.mp4 -t 4.8 -c copy output.mp4

# ç»“æœ
æœŸæœ›: 4.8 ç§’
å®é™…: ~1 ç§’ï¼ˆå®šä½åˆ°äº† 3.9s çš„å…³é”®å¸§ï¼‰
è¯¯å·®: 79% âŒ
```

### ä¿®å¤å
```bash
# å‘½ä»¤ï¼ˆç²¾ç¡®æ¨¡å¼ï¼Œå› ä¸º duration < 10ï¼‰
ffmpeg -i input.mp4 -ss 0 -t 4.8 -c copy -avoid_negative_ts make_zero output.mp4

# ç»“æœ
æœŸæœ›: 4.8 ç§’
å®é™…: 4.79 ç§’
è¯¯å·®: 0.2% âœ…

# å¦‚æœä»ç„¶ä¸ç²¾ç¡®ï¼ˆå…³é”®å¸§å¯¹é½é—®é¢˜ï¼‰
è‡ªåŠ¨åˆ‡æ¢åˆ°é‡æ–°ç¼–ç æ¨¡å¼ï¼Œç¡®ä¿ 100% ç²¾ç¡® âœ…
```

---

## ğŸ¯ æ—¥å¿—ç¤ºä¾‹

### ä¿®å¤åçš„æ—¥å¿—è¾“å‡º
```
[15:26:51] ğŸ”§ è£å‰ª: video_2025-08-16_17-47-54.mp4
[15:26:51] ğŸ”§ è£å‰ªå‚æ•°: å¼€å§‹=0.00s, ç»“æŸ=4.79s, æ—¶é•¿=4.79s
[15:26:51] ğŸ”§ æ£€æµ‹åˆ°éŸ³é¢‘æµ
[15:26:51] ğŸ”§ ä½¿ç”¨ç²¾ç¡®è£å‰ªæ¨¡å¼  â† å…³é”®ï¼
[15:26:51] âœ… æµå¤åˆ¶å®Œæˆ
[15:26:52] ğŸ”§ è¾“å‡ºéªŒè¯: æœŸæœ› 4.79s, å®é™… 4.79s  â† éªŒè¯é€šè¿‡
[15:26:52] âœ… ç‰‡æ®µå®Œæˆ: 1.52 MB
```

### å¦‚æœå‡ºç°æ—¶é•¿åå·®
```
[15:26:51] ğŸ”§ è£å‰ªå‚æ•°: å¼€å§‹=0.00s, ç»“æŸ=4.79s, æ—¶é•¿=4.79s
[15:26:51] ğŸ”§ ä½¿ç”¨ç²¾ç¡®è£å‰ªæ¨¡å¼
[15:26:52] ğŸ”§ è¾“å‡ºéªŒè¯: æœŸæœ› 4.79s, å®é™… 1.23s  â† æ£€æµ‹åˆ°åå·®
[15:26:52] ğŸ”§ è­¦å‘Š: è£å‰ªæ—¶é•¿åå·®è¿‡å¤§ï¼Œé‡æ–°ç¼–ç   â† è‡ªåŠ¨ä¿®å¤
[15:27:03] ğŸ”§ é‡æ–°ç¼–ç å®Œæˆ
[15:27:03] ğŸ”§ ç¼–ç éªŒè¯: æœŸæœ› 4.79s, å®é™… 4.79s  â† ä¿®å¤æˆåŠŸ
```

---

## âš™ï¸ æŠ€æœ¯ç»†èŠ‚

### FFmpeg çš„ -ss å‚æ•°è¯¦è§£

#### ä½ç½®å½±å“
| å‚æ•°é¡ºåº | å®šä½æ–¹å¼ | ç²¾åº¦ | é€Ÿåº¦ | åŸç† |
|----------|----------|------|------|------|
| `-ss` åœ¨ `-i` å‰ | å…³é”®å¸§å®šä½ | ä½ï¼ˆ~10ç§’ï¼‰ | å¿« | ç›´æ¥è·³è½¬åˆ°å…³é”®å¸§ï¼Œä¸è§£ç  |
| `-ss` åœ¨ `-i` å | å¸§çº§å®šä½ | é«˜ï¼ˆç²¾ç¡®åˆ°å¸§ï¼‰ | æ…¢ | è§£ç åˆ°æŒ‡å®šä½ç½® |

#### ä¸ºä»€ä¹ˆä¼šä¸ç²¾ç¡®ï¼Ÿ

**å…³é”®å¸§ï¼ˆI-frameï¼‰é—´éš”**:
- å¤§å¤šæ•°è§†é¢‘ï¼šæ¯ 250 å¸§ä¸€ä¸ªå…³é”®å¸§ï¼ˆçº¦ 10 ç§’ @ 25fpsï¼‰
- é«˜è´¨é‡è§†é¢‘ï¼šæ¯ 125 å¸§ä¸€ä¸ªå…³é”®å¸§ï¼ˆçº¦ 5 ç§’ @ 25fpsï¼‰
- ä½å»¶è¿Ÿè§†é¢‘ï¼šæ¯ 25-50 å¸§ä¸€ä¸ªå…³é”®å¸§ï¼ˆçº¦ 1-2 ç§’ @ 25fpsï¼‰

**ç¤ºä¾‹**:
```
è§†é¢‘å…³é”®å¸§ä½ç½®: 0s, 3.9s, 7.8s, 11.7s, ...

å‘½ä»¤: ffmpeg -ss 0 -i input.mp4 -t 4.8
å®šä½åˆ°: 0sï¼ˆæœ€è¿‘çš„å…³é”®å¸§ï¼‰
ç»“æœ: 0s - 4.8s âœ… æ­£ç¡®

å‘½ä»¤: ffmpeg -ss 2 -i input.mp4 -t 4.8
å®šä½åˆ°: 3.9sï¼ˆä¸‹ä¸€ä¸ªå…³é”®å¸§ï¼‰
ç»“æœ: 3.9s - 8.7s âŒ é”™è¯¯ï¼å°‘äº† 2 ç§’
```

---

### avoid_negative_ts å‚æ•°

| å€¼ | ç”¨é€” | æ¨èåœºæ™¯ |
|----|------|----------|
| `1` | å…è®¸è´Ÿæ—¶é—´æˆ³ | ä¸€èˆ¬ç”¨é€” |
| `make_zero` | å°†è´Ÿæ—¶é—´æˆ³è®¾ä¸º 0 | ç²¾ç¡®è£å‰ªï¼ˆæ¨èï¼‰ |
| `auto` | è‡ªåŠ¨é€‰æ‹© | ä¸æ¨è |

**ä¸ºä»€ä¹ˆä½¿ç”¨ make_zero?**
- ç²¾ç¡®è£å‰ªæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿè´Ÿçš„ PTSï¼ˆPresentation Time Stampï¼‰
- `make_zero` ç¡®ä¿æ‰€æœ‰æ—¶é—´æˆ³ â‰¥ 0ï¼Œé¿å…æ’­æ”¾å™¨é—®é¢˜

---

## ğŸš€ ä½¿ç”¨å»ºè®®

### çŸ­è§†é¢‘ï¼ˆ< 10 ç§’ï¼‰
- âœ… è‡ªåŠ¨ä½¿ç”¨ç²¾ç¡®è£å‰ªæ¨¡å¼
- âœ… å¸§çº§ç²¾ç¡®åº¦
- âš ï¸ ç¨æ…¢ï¼ˆéœ€è¦è§£ç ï¼‰ï¼Œä½†å¯æ¥å—

### é•¿è§†é¢‘ï¼ˆâ‰¥ 10 ç§’ï¼‰
- âœ… è‡ªåŠ¨ä½¿ç”¨å¿«é€Ÿè£å‰ªæ¨¡å¼
- âœ… å…³é”®å¸§çº§ç²¾åº¦ï¼ˆÂ±5ç§’å†…å¯æ¥å—ï¼‰
- âœ… éå¸¸å¿«ï¼ˆæµå¤åˆ¶ï¼‰

### å…³é”®å¸§å¯¹é½çš„è§†é¢‘
å¦‚æœè§†é¢‘æºæœ‰é¢‘ç¹çš„å…³é”®å¸§ï¼ˆå¦‚å½•å±ã€æ¸¸æˆè§†é¢‘ï¼‰ï¼Œå¯ä»¥é™ä½é˜ˆå€¼ï¼š
```javascript
const useAccurateMode = duration < 5;  // 5 ç§’ä»¥ä¸‹ç”¨ç²¾ç¡®æ¨¡å¼
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹ 1: çŸ­è§†é¢‘ç²¾ç¡®è£å‰ª
```javascript
è¾“å…¥: 0s - 4.79sï¼ˆ4.79 ç§’ç‰‡æ®µï¼‰
æ¨¡å¼: ç²¾ç¡®è£å‰ª
æœŸæœ›: 4.79s
å®é™…: 4.79s âœ…
```

### æµ‹è¯•ç”¨ä¾‹ 2: é•¿è§†é¢‘å¿«é€Ÿè£å‰ª
```javascript
è¾“å…¥: 10s - 45sï¼ˆ35 ç§’ç‰‡æ®µï¼‰
æ¨¡å¼: å¿«é€Ÿè£å‰ª
æœŸæœ›: 35s
å®é™…: 34.8s - 35.2s âœ…ï¼ˆå…³é”®å¸§å¯¹é½ï¼Œå¯æ¥å—è¯¯å·®ï¼‰
```

### æµ‹è¯•ç”¨ä¾‹ 3: ä¸ç²¾ç¡®æ—¶è‡ªåŠ¨é‡ç¼–ç 
```javascript
è¾“å…¥: 2s - 7sï¼ˆ5 ç§’ç‰‡æ®µï¼Œå…³é”®å¸§åœ¨ 0s, 7.8sï¼‰
æ¨¡å¼: ç²¾ç¡®è£å‰ª â†’ æµå¤åˆ¶å¤±è´¥ â†’ è‡ªåŠ¨é‡ç¼–ç 
æœŸæœ›: 5s
å®é™…: 5.0s âœ…ï¼ˆé‡ç¼–ç ä¿è¯ç²¾ç¡®ï¼‰
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜æ ¹æº
- FFmpeg çš„ `-ss` å‚æ•°åœ¨ `-i` ä¹‹å‰æ—¶ä½¿ç”¨å…³é”®å¸§å®šä½
- å¯¼è‡´çŸ­è§†é¢‘è£å‰ªä¸ç²¾ç¡®ï¼ˆä¸¢å¤± 50-80% çš„å†…å®¹ï¼‰

### è§£å†³æ–¹æ¡ˆ
- âœ… çŸ­è§†é¢‘ï¼ˆ<10ç§’ï¼‰ä½¿ç”¨ç²¾ç¡®æ¨¡å¼ï¼ˆ`-ss` åœ¨ `-i` ä¹‹åï¼‰
- âœ… é•¿è§†é¢‘ï¼ˆâ‰¥10ç§’ï¼‰ä½¿ç”¨å¿«é€Ÿæ¨¡å¼ï¼ˆ`-ss` åœ¨ `-i` ä¹‹å‰ï¼‰
- âœ… è‡ªåŠ¨éªŒè¯è¾“å‡ºæ—¶é•¿ï¼Œåå·® >10% æ—¶è‡ªåŠ¨é‡ç¼–ç 
- âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•

### æ•ˆæœ
- âœ… çŸ­è§†é¢‘è£å‰ªç²¾åº¦ï¼š99.8%
- âœ… é•¿è§†é¢‘å¤„ç†é€Ÿåº¦ï¼šä¿æŒå¿«é€Ÿ
- âœ… ç”¨æˆ·ä½“éªŒï¼šæ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè‡ªåŠ¨ä¼˜åŒ–

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [FFmpeg Wiki: Seeking](https://trac.ffmpeg.org/wiki/Seeking)
- [FFmpeg Documentation: -ss option](https://ffmpeg.org/ffmpeg-all.html#Main-options)
- [Video Frame Types (I, P, B frames)](https://en.wikipedia.org/wiki/Video_compression_picture_types)

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨ 4 ç§’çš„è§†é¢‘åº”è¯¥èƒ½æ­£ç¡®è£å‰ªä¸º 4 ç§’äº†ã€‚** âœ¨
