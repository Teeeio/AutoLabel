<svg width="1800" height="1400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-size: 32px; font-weight: bold; fill: #1e293b; }
      .subtitle { font-size: 20px; font-weight: 600; fill: #dc2626; }
      .section-title { font-size: 18px; font-weight: 700; fill: #0f172a; }
      .warning-box { fill: #fef2f2; stroke: #dc2626; stroke-width: 3; rx: 10; }
      .solution-box { fill: #f0fdf4; stroke: #059669; stroke-width: 3; rx: 10; }
      .tech-box { fill: #ffffff; stroke: #94a3b8; stroke-width: 2; rx: 8; }
      .critical { fill: #fee2e2; stroke: #dc2626; stroke-width: 2; }
      .correct { fill: #dcfce7; stroke: #059669; stroke-width: 2; }
      .bilibili-source { fill: #fef3c7; stroke: #f59e0b; stroke-width: 3; }
      .local-source { fill: #dbeafe; stroke: #3b82f6; stroke-width: 3; }
      .normalized { fill: #dcfce7; stroke: #059669; stroke-width: 3; }
      .problem { fill: #fecaca; stroke: #dc2626; stroke-width: 2; stroke-dasharray: 5,5; }
      .arrow-flow { stroke: #3b82f6; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .arrow-warn { stroke: #dc2626; stroke-width: 3; fill: none; marker-end: url(#arrowhead-red); stroke-dasharray: 8,4; }

      .label { font-size: 14px; font-weight: 600; fill: #1e293b; }
      .detail { font-size: 12px; fill: #475569; }
      .code { font-size: 11px; fill: #1e293b; font-family: 'Consolas', 'Monaco', monospace; }
      .error-text { font-size: 13px; fill: #dc2626; font-weight: 600; }
      .success-text { font-size: 13px; fill: #059669; font-weight: 600; }
      .warning-text { font-size: 13px; fill: #b45309; font-weight: 600; }
    </style>
    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#3b82f6"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#dc2626"/>
    </marker>
  </defs>

  <!-- æ ‡é¢˜ -->
  <text x="900" y="50" text-anchor="middle" class="title">å¤šæºè§†é¢‘æ‹¼æ¥ï¼šæ—¶é—´åŸºå‡†é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</text>
  <text x="900" y="85" text-anchor="middle" class="subtitle">âš ï¸ å…³é”®é—®é¢˜ï¼šVFR/CFR æ··ç”¨ä¸ Timebase ä¸ä¸€è‡´</text>

  <!-- ==================== é—®é¢˜åœºæ™¯åˆ†æ ==================== -->

  <g transform="translate(50, 120)">
    <rect x="0" y="0" width="1700" height="280" class="warning-box" rx="10"/>
    <text x="850" y="35" text-anchor="middle" class="section-title" fill="#dc2626">âŒ é—®é¢˜åœºæ™¯ï¼šæ—¶é—´åŸºå‡†ä¸ä¸€è‡´å¯¼è‡´çš„æ’­æ”¾å¼‚å¸¸</text>

    <!-- åœºæ™¯ç¤ºä¾‹ -->
    <g transform="translate(30, 60)">
      <rect x="0" y="0" width="820" height="200" class="problem" rx="8"/>
      <text x="410" y="25" text-anchor="middle" class="error-text">åœºæ™¯ï¼šBilibili + æœ¬åœ°è§†é¢‘æ··åˆ</text>

      <g transform="translate(20, 45)">
        <text x="0" y="0" class="warning-text">ç‰‡æ®µA (Bilibili):</text>
        <text x="0" y="20" class="detail">â€¢ Timebase: 1/90000 (CFR, å›ºå®šå¸§ç‡)</text>
        <text x="0" y="40" class="detail">â€¢ å¸§ç‡: 60fps, æ¯å¸§é—´éš” 1500 time units</text>
        <text x="0" y="60" class="detail">â€¢ ç»è¿‡Bç«™è½¬ç ï¼Œæ—¶é—´è½´æ•´é½</text>

        <text x="0" y="90" class="warning-text">ç‰‡æ®µB (æœ¬åœ°):</text>
        <text x="0" y="110" class="detail">â€¢ Timebase: 1/15360 (VFR, å¯å˜å¸§ç‡)</text>
        <text x="0" y="130" class="detail">â€¢ å¸§ç‡: 30fps (åŸå§‹), ä½†æ—¶é—´æˆ³ä¸å‡åŒ€</text>
        <text x="0" y="150" class="detail">â€¢ æ‰‹æœº/OBSå½•å±ï¼Œå¸¸è§é—®é¢˜</text>
      </g>

      <g transform="translate(420, 45)">
        <text x="0" y="0" class="error-text">â†’ ä½¿ç”¨ concat æ‹¼æ¥å:</text>

        <text x="0" y="30" class="detail">1. concat ä»¥ç‰‡æ®µAä¸ºåŸºå‡† (timebase 1/90000)</text>
        <text x="0" y="50" class="detail">2. æ’­æ”¾å™¨ç”¨Açš„å°ºå­å»è¡¡é‡B</text>
        <text x="0" y="70" class="detail">3. ç‰‡æ®µBçš„30fpsè¢«å½“åš60fpsæ’­æ”¾ â†’ âŒ 2å€é€Ÿ!</text>
        <text x="0" y="90" class="detail">4. æˆ–è€…Bçš„1/15360è¢«å¼ºåˆ¶è½¬æ¢ä¸º1/90000</text>
        <text x="0" y="110" class="detail">5. æ—¶é—´æˆ³è®¡ç®—é”™è¯¯ â†’ âŒ éŸ³ç”»ä¸åŒæ­¥</text>

        <rect x="0" y="130" width="380" height="50" fill="#dc2626" rx="4"/>
        <text x="190" y="152" text-anchor="middle" class="code" fill="#ffffff">ç»“æœï¼šæ’­æ”¾é€Ÿåº¦å¼‚å¸¸ æˆ– ç”»é¢è·³å¸§</text>
      </g>
    </g>

    <!-- æ ¹æœ¬åŸå›  -->
    <g transform="translate(870, 60)">
      <rect x="0" y="0" width="800" height="200" class="problem" rx="8"/>
      <text x="400" y="25" text-anchor="middle" class="error-text">ğŸ” æ ¹æœ¬åŸå› åˆ†æ</text>

      <g transform="translate(20, 45)">
        <text x="0" y="0" class="label">1. VFR vs CFR:</text>
        <text x="0" y="20" class="detail">â€¢ CFR (æ’å®šå¸§ç‡): æ¯å¸§é—´éš”ç›¸åŒ, timebaseä¸€è‡´</text>
        <text x="0" y="40" class="detail">â€¢ VFR (å¯å˜å¸§ç‡): ç¼–ç å™¨ä¼˜åŒ–, çœç©ºé—´ä½†æ—¶é—´æˆ³ä¸å‡åŒ€</text>

        <text x="0" y="70" class="label">2. Timebase æ··ä¹±:</text>
        <text x="0" y="90" class="code">1/90000 (60fps CFR), 1/15360 (30fps VFR)</text>
        <text x="0" y="110" class="code">1/1000 (å½•å±å¸¸è§), 1/24000 (ç‰¹æ®Šè®¾å¤‡)</text>

        <text x="0" y="140" class="label">3. -vsync 0 çš„é™·é˜±:</text>
        <text x="0" y="160" class="detail">â€¢ "ä¿æŒåŸæ—¶é—´æˆ³" = ä¿æŒVFRçš„æ··ä¹±çŠ¶æ€</text>
        <text x="0" y="180" class="detail">â€¢ CFR + VFR æ··åˆ = âŒ å¿…å®šå‡ºé—®é¢˜</text>
      </g>
    </g>
  </g>

  <!-- ==================== è§£å†³æ–¹æ¡ˆAï¼šå¼ºåˆ¶æ ‡å‡†åŒ–è½¬ç  ==================== -->

  <text x="50" y="440" class="section-title">âœ… è§£å†³æ–¹æ¡ˆ Aï¼šå¼ºåˆ¶æ ‡å‡†åŒ–ï¼ˆæ¨èï¼Œé€Ÿåº¦å¿«ï¼‰</text>

  <g transform="translate(50, 470)">
    <rect x="0" y="0" width="850" height="450" class="solution-box" rx="10"/>
    <text x="425" y="35" text-anchor="middle" class="success-text">é˜¶æ®µ1: ä¸¥æ ¼æ ‡å‡†åŒ–è½¬ç ï¼ˆæ‰€æœ‰ç´ æå¿…é¡»ç»è¿‡ï¼‰</text>

    <!-- æ ¸å¿ƒåŸåˆ™ -->
    <g transform="translate(30, 60)">
      <rect x="0" y="0" width="790" height="50" fill="#059669" rx="6"/>
      <text x="395" y="20" text-anchor="middle" class="code" fill="#ffffff" font-size="14">æ ¸å¿ƒåŸåˆ™ï¼šæ”¾å¼ƒ"ç›´æ¥ä½¿ç”¨"ï¼Œæ‰€æœ‰ç´ æç»Ÿä¸€è½¬ç </text>
      <text x="395" y="40" text-anchor="middle" class="detail" fill="#ffffff">æ— è®ºæ˜¯Bilibiliè¿˜æ˜¯æœ¬åœ°ï¼Œæ— è®ºæ˜¯å¦"å…¼å®¹"ï¼Œå…¨éƒ¨å¼ºåˆ¶è½¬ç </text>
    </g>

    <!-- Bilibiliå¤„ç† -->
    <g transform="translate(30, 125)">
      <rect x="0" y="0" width="380" height="140" class="bilibili-source"/>
      <text x="190" y="25" text-anchor="middle" class="section-title" fill="#b45309">Bilibili æºå¤„ç†</text>

      <text x="15" y="50" class="label">ä¸‹è½½åå¿…é¡»è½¬ç :</text>
      <text x="15" y="70" class="code">-r 60 -fps_mode cfr</text>
      <text x="15" y="90" class="code">-video_track_timescale 90000</text>
      <text x="15" y="110" class="code">-c:v libx264 -preset medium -crf 18</text>
      <text x="15" y="130" class="detail">å¼ºåˆ¶CFR, å›ºå®štimebase</text>
    </g>

    <!-- æœ¬åœ°å¤„ç† -->
    <g transform="translate(430, 125)">
      <rect x="0" y="0" width="390" height="140" class="local-source"/>
      <text x="195" y="25" text-anchor="middle" class="section-title" fill="#1d4ed8">æœ¬åœ°æºå¤„ç†</text>

      <text x="15" y="50" class="label">âŒ ç§»é™¤"å…¼å®¹æ£€æŸ¥ç›´æ¥ä½¿ç”¨"</text>
      <text x="15" y="70" class="label">âœ“ å¿…é¡»å¼ºåˆ¶è½¬ç :</text>
      <text x="15" y="90" class="code">-r 60 -fps_mode cfr</text>
      <text x="15" y="110" class="code">-video_track_timescale 90000</text>
      <text x="15" y="130" class="detail">å³ä½¿æ˜¯H.264ä¹Ÿè¦è½¬ç !</text>
    </g>

    <!-- å…³é”®å‚æ•°è¯´æ˜ -->
    <g transform="translate(30, 280)">
      <rect x="0" y="0" width="790" height="140" class="tech-box"/>
      <text x="395" y="25" text-anchor="middle" class="label">å…³é”®å‚æ•°è¯¦è§£</text>

      <g transform="translate(20, 40)">
        <text x="0" y="0" class="warning-text">-r 60 -fps_mode cfr</text>
        <text x="200" y="0" class="detail">å¼ºåˆ¶è¾“å‡º60fps, CFRæ¨¡å¼, é‡æ–°ç”Ÿæˆæ—¶é—´æˆ³</text>
      </g>

      <g transform="translate(20, 65)">
        <text x="0" y="0" class="warning-text">-video_track_timescale 90000</text>
        <text x="300" y="0" class="detail">å¼ºåˆ¶timebaseä¸º90000 (60fpsæ ‡å‡†)</text>
      </g>

      <g transform="translate(20, 90)">
        <text x="0" y="0" class="warning-text">-vsync cfr (æˆ– -vsync 1)</text>
        <text x="250" y="0" class="detail">æ’å®šå¸§ç‡æ¨¡å¼, æ¯å¸§æ—¶é—´é—´éš”å®Œå…¨ä¸€è‡´</text>
      </g>

      <g transform="translate(20, 115)">
        <text x="0" y="0" class="success-text">âœ“ ç¦æ­¢ä½¿ç”¨ -vsync 0 / -fps_mode passthrough</text>
        <text x="400" y="0" class="detail">è¿™ä¸ªå‚æ•°ä¼šä¿ç•™åŸè§†é¢‘çš„VFRç‰¹æ€§!</text>
      </g>
    </g>
  </g>

  <!-- ==================== è§£å†³æ–¹æ¡ˆBï¼šFilter Complex ==================== -->

  <text x="950" y="440" class="section-title">âœ… è§£å†³æ–¹æ¡ˆ Bï¼šFilter Complexï¼ˆæœ€ç¨³å¥ï¼‰</text>

  <g transform="translate(950, 470)">
    <rect x="0" y="0" width="800" height="450" class="solution-box" rx="10"/>
    <text x="400" y="35" text-anchor="middle" class="success-text">ä½¿ç”¨ filter_complex é‡ç»˜æ¯ä¸€å¸§</text>

    <g transform="translate(30, 60)">
      <rect x="0" y="0" width="740" height="370" class="tech-box"/>

      <text x="370" y="25" text-anchor="middle" class="label">å®Œæ•´æ»¤é•œé“¾ç¤ºä¾‹:</text>

      <g transform="translate(20, 40)">
        <rect x="0" y="0" width="700" height="140" fill="#1e293b" rx="4"/>
        <text x="20" y="20" class="code" fill="#ffffff">ffmpeg -i clip1.mp4 -i clip2.mp4 -i clip3.mp4 \</text>
        <text x="20" y="40" class="code" fill="#ffffff">  -filter_complex \</text>
        <text x="20" y="60" class="code" fill="#ffffff">    "[0:v]fps=60000/1001,settb=expr=1/90000,fps=60,round=round[v0]; \</text>
        <text x="20" y="80" class="code" fill="#ffffff">     [1:v]fps=60000/1001,settb=expr=1/90000,fps=60,round=round[v1]; \</text>
        <text x="20" y="100" class="code" fill="#ffffff">     [2:v]fps=60000/1001,settb=expr=1/90000,fps=60,round=round[v2]; \</text>
        <text x="20" y="120" class="code" fill="#ffffff">     [v0][v1][v2]concat=n=3:v=1[outv]" \</text>
        <text x="20" y="140" class="code" fill="#ffffff">  -map "[outv]" -c:v libx264 -r 60 output.mp4</text>
      </g>

      <g transform="translate(20, 195)">
        <text x="0" y="0" class="success-text">ä¼˜ç‚¹ï¼š</text>
        <text x="0" y="20" class="detail">âœ“ å½»åº•è§£å†³timebaseä¸ä¸€è‡´é—®é¢˜</text>
        <text x="0" y="40" class="detail">âœ“ å¼ºåˆ¶ç»Ÿä¸€å¸§ç‡</text>
        <text x="0" y="60" class="detail">âœ“ settb=expr=1/90000 é‡å†™æ—¶é—´æˆ³</text>
        <text x="0" y="80" class="detail">âœ“ fpsæ»¤é•œå¤„ç†VFRâ†’CFRè½¬æ¢</text>
      </g>

      <g transform="translate(400, 195)">
        <text x="0" y="0" class="warning-text">ç¼ºç‚¹ï¼š</text>
        <text x="0" y="20" class="detail">â€¢ å¤„ç†é€Ÿåº¦æ…¢ (é‡ç¼–ç æ‰€æœ‰å¸§)</text>
        <text x="0" y="40" class="detail">â€¢ CPUå ç”¨é«˜</text>
        <text x="0" y="60" class="detail">â€¢ æ–‡ä»¶å¤§å°å¯èƒ½å¢åŠ </text>
      </g>
    </g>
  </g>

  <!-- ==================== é˜¶æ®µ2ï¼šç²¾ç¡®è£å‰ªï¼ˆä¿®æ­£ç‰ˆï¼‰ ==================== -->

  <text x="50" y="960" class="section-title">é˜¶æ®µ2: ç²¾ç¡®è£å‰ªæŠ€æœ¯ï¼ˆå·²ä¿®æ­£ï¼‰</text>

  <g transform="translate(50, 990)">
    <rect x="0" y="0" width="1700" height="180" class="tech-box" rx="8"/>

    <g transform="translate(30, 30)">
      <text x="0" y="0" class="label">è£å‰ªå‘½ä»¤ï¼ˆå¿…é¡»é…åˆæ ‡å‡†åŒ–ä½¿ç”¨ï¼‰:</text>

      <g transform="translate(0, 25)">
        <rect x="0" y="0" width="1640" height="40" fill="#dcfce7" stroke="#059669" stroke-width="2" rx="4"/>
        <text x="20" y="18" class="code" fill="#047857">ffmpeg -ss {start} -to {end} -i input.mp4 -c:v libx264 -preset fast -crf 18 -r 60 -fps_mode cfr -video_track_timescale 90000 clip.mp4</text>
      </g>

      <g transform="translate(0, 80)">
        <text x="0" y="0" class="success-text">âœ… å…³é”®ç‚¹ï¼šè£å‰ªæ—¶ä¹Ÿå¼ºåˆ¶ç»Ÿä¸€å‚æ•°</text>
        <text x="0" y="20" class="detail">â€¢ è£å‰ªè¾“å‡ºçš„ç‰‡æ®µä¹Ÿè¦ç¬¦åˆç»Ÿä¸€æ ‡å‡†</text>
        <text x="0" y="40" class="detail">â€¢ é¿å…ç‰‡æ®µé—´å‚æ•°ä¸ä¸€è‡´</text>
      </g>
    </g>
  </g>

  <!-- ==================== é˜¶æ®µ3ï¼šæ‹¼æ¥ç­–ç•¥ï¼ˆä¿®æ­£ç‰ˆï¼‰ ==================== -->

  <text x="50" y="1200" class="section-title">é˜¶æ®µ3: æ‹¼æ¥ç­–ç•¥ï¼ˆå·²ä¿®æ­£ï¼‰</text>

  <g transform="translate(50, 1230)">
    <rect x="0" y="0" width="1700" height="140" class="solution-box" rx="10"/>

    <g transform="translate(30, 30)">
      <text x="0" y="0" class="success-text">âœ… å‰ææ¡ä»¶ï¼šæ‰€æœ‰ç‰‡æ®µå·²å®Œæˆæ ‡å‡†åŒ–è½¬ç </text>

      <g transform="translate(0, 30)">
        <text x="0" y="0" class="label">concat demuxer (ç°åœ¨å¯ä»¥å®‰å…¨ä½¿ç”¨):</text>
        <text x="0" y="20" class="code">file 'clip1.mp4' + file 'clip2.mp4' + ... â†’ concat.txt</text>
        <text x="0" y="40" class="code">ffmpeg -f concat -safe 0 -i concat.txt -c copy output.mp4</text>
        <text x="0" y="60" class="detail">âœ“ æ‰€æœ‰ç‰‡æ®µtimebaseä¸€è‡´ (1/90000)</text>
        <text x="0" y="80" class="detail">âœ“ æ‰€æœ‰ç‰‡æ®µå¸§ç‡ä¸€è‡´ (60fps CFR)</text>
      </g>
    </g>

    <g transform="translate(900, 30)">
      <text x="0" y="0" class="success-text">âš¡ æ€§èƒ½ä¼˜åŒ–ï¼š</text>
      <text x="0" y="30" class="detail">â€¢ æ ‡å‡†åŒ–è½¬ç å¯ä»¥å¹¶è¡Œå¤„ç†</text>
      <text x="0" y="50" class="detail">â€¢ æ‹¼æ¥æ—¶ä½¿ç”¨ -c copy æ— é‡ç¼–ç </text>
      <text x="0" y="70" class="detail">â€¢ æ•´ä½“é€Ÿåº¦å¯æ¥å—</text>
    </g>
  </g>

  <!-- ==================== æŠ€æœ¯æ€»ç»“ ==================== -->

  <g transform="translate(50, 1410)">
    <rect x="0" y="0" width="1700" height="220" fill="#fef3c7" stroke="#f59e0b" stroke-width="3" rx="10"/>
    <text x="850" y="35" text-anchor="middle" class="section-title" fill="#b45309">ğŸ¯ æ ¸å¿ƒè¦ç‚¹æ€»ç»“</text>

    <!-- è¦ç‚¹1 -->
    <g transform="translate(30, 55)">
      <rect x="0" y="0" width="400" height="140" fill="#dcfce7" stroke="#059669" stroke-width="2" rx="8"/>
      <text x="200" y="25" text-anchor="middle" class="success-text">1. å¿…é¡»å¼ºåˆ¶CFR</text>
      <text x="20" y="50" class="detail">âœ“ -fps_mode cfr (æˆ– -vsync 1)</text>
      <text x="20" y="70" class="detail">âœ“ -r 60 å›ºå®šå¸§ç‡</text>
      <text x="20" y="90" class="detail">âœ“ ç¦æ­¢ -vsync 0 (ä¿ç•™VFR)</text>
      <text x="20" y="115" class="error-text">âŒ VFR + CFR æ··åˆ = å¿…æŒ‚</text>
    </g>

    <!-- è¦ç‚¹2 -->
    <g transform="translate(450, 55)">
      <rect x="0" y="0" width="400" height="140" fill="#dcfce7" stroke="#059669" stroke-width="2" rx="8"/>
      <text x="200" y="25" text-anchor="middle" class="success-text">2. ç»Ÿä¸€Timebase</text>
      <text x="20" y="50" class="detail">âœ“ -video_track_timescale 90000</text>
      <text x="20" y="70" class="detail">âœ“ æ‰€æœ‰ç‰‡æ®µç”¨ç›¸åŒtimebase</text>
      <text x="20" y="90" class="detail">âœ“ é˜²æ­¢1/15360, 1/1000æ··å…¥</text>
      <text x="20" y="115" class="error-text">âŒ Timebaseä¸ä¸€è‡´ = æ’­æ”¾å¼‚å¸¸</text>
    </g>

    <!-- è¦ç‚¹3 -->
    <g transform="translate(870, 55)">
      <rect x="0" y="0" width="400" height="140" fill="#dcfce7" stroke="#059669" stroke-width="2" rx="8"/>
      <text x="200" y="25" text-anchor="middle" class="success-text">3. å…¨é‡è½¬ç ç­–ç•¥</text>
      <text x="20" y="50" class="detail">âœ“ æ”¾å¼ƒ"å…¼å®¹æ£€æŸ¥ç›´æ¥ä½¿ç”¨"</text>
      <text x="20" y="70" class="detail">âœ“ æœ¬åœ°H.264ä¹Ÿè¦è½¬ç </text>
      <text x="20" y="90" class="detail">âœ“ å½»åº•æ¶ˆé™¤æºå¤´å·®å¼‚</text>
      <text x="20" y="115" class="error-text">âŒ "ä¼˜åŒ–"=åŸ‹é›·éšæ‚£</text>
    </g>

    <!-- è¦ç‚¹4 -->
    <g transform="translate(1290, 55)">
      <rect x="0" y="0" width="400" height="140" fill="#dcfce7" stroke="#059669" stroke-width="2" rx="8"/>
      <text x="200" y="25" text-anchor="middle" class="success-text">4. ä¸¤ç§æ–¹æ¡ˆé€‰æ‹©</text>
      <text x="20" y="50" class="detail">æ–¹æ¡ˆA: æ ‡å‡†åŒ–+concat (å¿«)</text>
      <text x="20" y="70" class="detail">æ–¹æ¡ˆB: filter_complex (ç¨³)</text>
      <text x="20" y="90" class="detail">â€¢ æ¨è: æ–¹æ¡ˆA (é€Ÿåº¦å¿«)</text>
      <text x="20" y="115" class="error-text">âŒ ç»ä¸æ··ç”¨VFR/CFR</text>
    </g>
  </g>

</svg>
